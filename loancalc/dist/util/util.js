"use strict";var __awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const Crypto=require("crypto"),serve_1=require("../serve");function calculateLoanPayment(a,b,c){return b*a/(1-1/Math.pow(1+b,c))}exports.calculateLoanPayment=calculateLoanPayment;function equalsIgnoreCase(c,a){return c&&a?c.toLowerCase()===a.toLowerCase():c===a}exports.equalsIgnoreCase=equalsIgnoreCase;function isPromise(a){return a&&"function"==typeof a.then&&"function"==typeof a["catch"]}exports.isPromise=isPromise;function batchAsync(a,b,c,d=0){return __awaiter(this,void 0,void 0,function*(){for(let e=d||0;e<a.length;){const d=a.slice(e,e+b),f=c(d);isPromise(f)&&(yield f),e+=b}})}exports.batchAsync=batchAsync;function batch(a,b,c,d=0){for(let e=d||0;e<a.length;){const d=a.slice(e,e+b);c(d),e+=b}}exports.batch=batch;function createUploadStaticURL(a,b){let c;return c="production"===process.env.NODE_ENV?"":"http://localhost:8080",c+"/ustatic/"+b}exports.createUploadStaticURL=createUploadStaticURL;function trimIfString(a){return"string"==typeof a?a.trim():a}exports.trimIfString=trimIfString;function isStringWithContent(a){return"string"==typeof a&&0<trimIfString(a).length}exports.isStringWithContent=isStringWithContent;function lowerIfString(a){return"string"==typeof a?a.toLowerCase():a}exports.lowerIfString=lowerIfString;function isDuplicateLead(a,b){return a.visitor_uuid==b.visitor_uuid&&equalsIgnoreCase(a.first_name,b.first_name)&&equalsIgnoreCase(a.last_name,b.last_name)}exports.isDuplicateLead=isDuplicateLead;function parseFacebookSignedRequest(a,b){try{const[c,d]=a.split("."),e=Crypto.createHmac("sha256",b);e.update(d);const f=Buffer.from(decodeURIComponent(c),"base64").toString("base64"),g=e.digest("base64");if(f===g){const a=JSON.parse(Buffer.from(decodeURIComponent(d),"base64").toString("utf-8"));return a}serve_1.Logger.warn("Signature did not match expected signature!")}catch(b){serve_1.Logger.warn("Failed to decode Facebook signed request: %s",a.substr(0,256),b)}return null}exports.parseFacebookSignedRequest=parseFacebookSignedRequest;function formatCalculatorTypeId(a){return"auto-loan"===a?"Auto Loan":"mortgage-loan"===a?"Mortgage":"personal-loan"===a?"Personal Loan":"Unspecified"}exports.formatCalculatorTypeId=formatCalculatorTypeId;