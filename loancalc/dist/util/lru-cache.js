"use strict";Object.defineProperty(exports,"__esModule",{value:!0});const DEFAULT_DISPOSE=()=>{},DEFAULT_SIZE_CALC=()=>1;class LRUItem{isExpired(a){const b=Date.now(),c=this.maxAge===void 0?a:this.maxAge;return!(0>=c)&&b>this.entryTime+c}isExpiredAt(a,b){const c=this.maxAge===void 0?b:this.maxAge;return!(0>=c)&&a>this.entryTime+c}}exports.LRUItem=LRUItem;class LRUCache{constructor(a){this._map=new Map,this._size=0,this._maxSize=0,this._maxAge=0,this.calculateSize=DEFAULT_SIZE_CALC,this.disposeOfItem=DEFAULT_DISPOSE,this._map=new Map,this._size=0,this._maxSize=a.maxSize===void 0?0:a.maxSize,this._maxAge=a.maxAge===void 0?0:a.maxAge,this.calculateSize=a.size===void 0?DEFAULT_SIZE_CALC:a.size,this.disposeOfItem=a.dispose===void 0?DEFAULT_DISPOSE:a.dispose}get(a){const b=this._map.get(a);return b&&!b.isExpired(this._maxAge)?b.value:void 0}set(a,b,c){const d=new LRUItem;return d.entryTime=Date.now(),d.maxAge=c,d.value=b,d.size=this.calculateSize(b,a),this._map.has(a)&&this.dispose(this._map.get(a),a),this._map.set(a,d),this._size+=d.size,this.trim(),this}has(a){const b=this._map.get(a);return!!b&&!b.isExpired(this._maxAge)}prune(){let a,b=this._map.entries();for(const c=Date.now();!(a=b.next()).done;){const[b,d]=a.value;d.isExpiredAt(c,this._maxAge)&&(this.dispose(d,b),this._map.delete(b))}}trim(){if(!(this._size<=this._maxSize))for(let a,b=this._map.entries();this._size>this._maxSize&&!(a=b.next()).done;){const[b,c]=a.value;this.dispose(c,b),this._map.delete(b)}}dispose(a,b){this.disposeOfItem(a.value,b),this._size-=a.size}keys(){return this._map.keys()}values(){return this._map.values()}clear(){this._map.clear(),this._size=0}delete(a){return this._map.delete(a)}entries(){return this._map.entries()}forEach(a,b){this._map.forEach(a,b)}get internalMap(){return this._map}get size(){return this._size}get maxAge(){return this._maxAge}set maxAge(a){this._maxAge=a,this.trim()}get maxSize(){return this._maxSize}set maxSize(a){this._maxSize=a,this.trim()}}exports.default=LRUCache;