"use strict";var __awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const sharp=require("sharp"),serve_1=require("../serve"),IMAGE_MIME_TYPES=new Set(["image/gif","image/jpeg","image/png","image/svg+xml"]),__taggedFileProcessors={};function registerTaggedFileProcessor(a,b){__taggedFileProcessors[a]=b}function getTaggedFileProcessor(a){return __taggedFileProcessors[a]||void 0}exports.getTaggedFileProcessor=getTaggedFileProcessor;class ProfileImageProcessor{checkMimeType(a){return IMAGE_MIME_TYPES.has(a)}getDestinationExt(){return"png"}process(a,b){return __awaiter(this,void 0,void 0,function*(){return yield sharp(a).resize(128,128).background({r:0,g:0,b:0,alpha:0}).embed().toFile(b),serve_1.Logger.debug("Saved profile image to \"%s\"",b),!0})}}registerTaggedFileProcessor("profile",new ProfileImageProcessor);class BrandingImageProcessor{checkMimeType(a){return IMAGE_MIME_TYPES.has(a)}getDestinationExt(){return"png"}process(a,b){return __awaiter(this,void 0,void 0,function*(){return yield sharp(a).resize(400,80).background({r:0,g:0,b:0,alpha:0}).embed().toFile(b),serve_1.Logger.debug("Saved branding image to \"%s\"",b),!0})}}registerTaggedFileProcessor("branding",new BrandingImageProcessor);