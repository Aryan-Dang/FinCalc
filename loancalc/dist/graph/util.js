"use strict";var __awaiter=this&&this.__awaiter||function(a,b,c,d){return new(c||(c=Promise))(function(e,f){function g(a){try{i(d.next(a))}catch(a){f(a)}}function h(a){try{i(d["throw"](a))}catch(a){f(a)}}function i(a){a.done?e(a.value):new c(function(b){b(a.value)}).then(g,h)}i((d=d.apply(a,b||[])).next())})};Object.defineProperty(exports,"__esModule",{value:!0});const serve_1=require("../serve");function checkPermissions(a,b,c){return __awaiter(this,void 0,void 0,function*(){try{switch(a){case"calculator":return yield checkCalculatorPermissions(b,c);case"client":return yield checkClientPermissions(b,c);}}catch(b){serve_1.Logger.error(`Error while checking permissions on '${a}': `,b)}return!1})}exports.checkPermissions=checkPermissions;function checkClientPermissions(a,b){return __awaiter(this,void 0,void 0,function*(){if("string"==typeof a&&(a={uuid:a}),!a||"object"!=typeof a)return!1;const c=yield b.getCurrentUser();return"super"===c.role||!!a.uuid&&c.client_uuid===a.uuid})}exports.checkClientPermissions=checkClientPermissions;function checkCalculatorPermissions(a,b){return __awaiter(this,void 0,void 0,function*(){if("string"==typeof a&&(a={uuid:a}),!a||"object"!=typeof a)return!1;const c=yield b.getCurrentUser();if("super"===c.role||"admin"===c.role)return!0;let d;if(!a.client_uuid){let c;if(a.uuid)c=yield b.Calculators.getById(a.uuid);else if(a.shortid)c=yield b.Calculators.getByShortId(a.shortid);else return!1;if(c)d=c.client_uuid;else return!1}else d=a.client_uuid;return d===c.client_uuid})}exports.checkCalculatorPermissions=checkCalculatorPermissions;function property(a){return"string"==typeof a?(b)=>b[a]:()=>a.reduce((a,b)=>a?a[b]:a,{})}exports.property=property;function multipleParamString(a,b=void 0){return b?a.reduce((a,c,d)=>a+(0<d?", ":"")+b("$"+(d+1)),""):a.reduce((a,b,c)=>a+(0<c?", ":"")+" $"+(c+1),"")}exports.multipleParamString=multipleParamString;